# OA-TSC (Orthogonality-Aware Triangulated Self-Consistency) - Proposed Method
# Model: Qwen3-8B, Dataset: GSM8K

run_id: proposed-qwen3-8b-gsm8k

method:
  name: OA-TSC
  type: proposed
  description: "Orthogonality-Aware Triangulated Self-Consistency - forces three within-sample reasoning views with agreement+orthogonality weighted voting"
  
  # Inference parameters
  temperature: 0.7
  top_p: 0.95
  max_new_tokens: 450
  k_samples: 10  # Will be tuned by Optuna
  
  # Prompt template - three-view triangulated structure
  prompt_template: |
    Q: {question}
    A: Provide three different reasoning views and then three finals.
    
    Plan (JSON, 1-3 lines): keys = unknown, givens, constraints.
    
    Solve-A: forward step-by-step solution in natural language.
    
    Solve-B: equation-only derivation (use equations, variable names, and minimal annotations; avoid copying Solve-A wording).
    
    Check-C: backsolve/plug-in check starting from the candidate answer; verify against givens/constraints.
    
    End with exactly three lines:
    FinalA: <numeric>
    FinalB: <numeric>
    FinalC: <numeric>
  
  # Weighting parameters (will be tuned by Optuna)
  tau_copy_threshold: 0.35
  b2_agree2_weight: 1.0
  b3_agree3_weight: 1.5
  d_orth_weight: 0.8
  g_cons_weight: 0.5
  copy_penalty_scale: 0.8

model:
  name: Qwen/Qwen2.5-7B-Instruct
  hf_model_id: Qwen/Qwen2.5-7B-Instruct
  torch_dtype: bfloat16
  device_map: auto
  cache_dir: .cache/models

dataset:
  name: gsm8k
  hf_dataset_id: gsm8k
  hf_dataset_config: main
  split: test
  n_samples: 200  # Full evaluation on 200 test samples
  n_tune_samples: 80  # Smaller subset for Optuna tuning
  cache_dir: .cache/datasets
  
  # Dataset-specific field mappings
  question_field: question
  answer_field: answer

training:
  seed: 42
  mode: main  # Will be overridden by --sanity_check flag

optuna:
  enabled: true
  n_trials: 12
  study_name: oa-tsc-qwen3-8b-gsm8k
  direction: maximize
  metric: accuracy
  
  search_spaces:
    - param_name: tau_copy_threshold
      distribution_type: uniform
      low: 0.2
      high: 0.6
    
    - param_name: b2_agree2_weight
      distribution_type: uniform
      low: 0.3
      high: 1.8
    
    - param_name: b3_agree3_weight
      distribution_type: uniform
      low: 0.8
      high: 2.5
    
    - param_name: d_orth_weight
      distribution_type: uniform
      low: 0.0
      high: 1.5
    
    - param_name: copy_penalty_scale
      distribution_type: uniform
      low: 0.0
      high: 1.5
    
    - param_name: k_samples
      distribution_type: int
      low: 6
      high: 12

evaluation:
  primary_metric: accuracy
  
  metrics:
    - accuracy
    - mean_weighted_vote_margin
    - agree3_rate
    - orthogonality_correlation_with_correctness
    - correctness_auc_from_proxy_score
    - tokens_per_question
